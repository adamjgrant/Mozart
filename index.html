<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="kickstart.min.css" />
  </head>
  <body>
    <style>.docs > main { opacity: 0; transition: 2s all; }</style>
    <div class="docs">
      <header class="document">
        <div class="content">
          <br><h1 class="toc-exempt">Mozart.js</h1>
          <p>Learn more on <a href="https://github.com/adamjgrant/Mozart">Github</a></p>
          <div id="toc"></div>
          <br>
        </div>
        <div class="code">
          <pre><code></code></pre>
        </div>
      </header>

      <main class="document">
      </main>

      <main class="document">
        <div class="content">
          <h1 class="sm">Create a component</h1>
          <p>Before anything else, you'll need to load the Mozart script and declare your first component.</p>
          <p>The variable <code>m$</code> is provided by Mozart to organize your components at a high level
            without cluttering the <code>window</code> namespace.</p>
          <p>Every component should follow the pattern <code>m$.[component name]</code></p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table = new Mozart;</code>
          </pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <p>Mozart will know to look for HTML elements with a <code>data-component</code> attribute that includes
            <code>user_table</code> when referencing <code>m$.user_table</code></p>

          <p>It's good practice to put in some fallback content for the component if you plan on dynamically filling
          from an external data source.</p>

          <p>In this case, we've put "Loading users" as our first rung of the user table because we intend for there
            to be some delay before the user list comes in from the server. Once it is, we'll wipe away the contents
            of the <code>data-render</code> field.</p>

          <p>We'll get to that later when we talk about templates.</p>
        </div>
        <div class="code">
          <pre><code class="html"><div data-component="user_table">
  <h1>User Table</h1>
  <ul data-render>
    <li>Loading users...</li>
  </ul>
</div></code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h2 class="xs">Define an API</h2>
          <p>The API of your component will define named entry points into discreet functionality.</p>
          <p>For this example, we'll assume we need to perform a basic database query to populate the table</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.api({
  get_users: function(_$, options) {
    // ...
  }
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h3 class="xxs">Scoped selector</h3>
          <p><code>_$</code> will automatically be scoped to your component.</p>
          <p>If you're using jQuery, this means this code woudl be the equivalent of calling
            <code>$("[data-component~='user_table'] h1").html("test");</code></p>
          <p>If you're using plain JavaScript, this would be the equivalent of calling
            <code>document.querySelectorAll("[data-component~='user_table'] h1")</code> so
            be mindful that this will always return an array. You'll need to tack on a <code>[0]</code>
            at the end if you expect and want to work with only one element.</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.api({
  get_users: function(_$, options) {
    _$("h1").html("test");

    // OR

    _$("h1")[0].innerHTML = "test"; // If not using jQuery
  }
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h3 class="xxs">Calling api commands</h3>
          <p>If calling the component's own api command, you can either call from
            <code>this</code> (assuming you maintain binding as you would in any JavaScript project)
            or <code>_$.api</code> which will persist <code>this</code> and can also be used in your
            events configuration.</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.api({
  ask_bar_to_say_foo: function(_$, options) {
    _$.api.bar_says_foo();
    // or this.bar_says_foo();
  },

  bar_says_foo: function(_$, options) {
    alert("foo");
  }
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <p>To call another component's api, just replace the <code>_$</code> with <code>m$</code>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.component_a.api({
  tell_b_to_say_foo: function(_$, options) {
    m$.component_b.say_foo();
  }
});

m$.component_b.api({
  say_foo: function(_$, options) {
    alert("foo");
  }
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h3 class="xxs">Arguments</h3>
          <p>Notice that each api function has two arguments, <code>_$</code> and <code>options</code></p>
          <p>Callers need not worry about passing in <code>_$</code>, Mozart does this for you. Instead treat
            the api function as if it took only the argument <code>options</code>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.person_reporter.api({
  display_name_and_age: function(_$, options) {
    alert("Name is " + options.name + " and age is " + options.age);
  }
});

m$.person_reporter.events(function(_$) {
  _$("button").click(function() {
    var name = _$(".name").val(),
        age  = _$(".age").val();

    // Only one {} argument needed.
    _$.api.display_name_and_age({ name: name, age: age })
  });
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h2 class="xs">Define routes</h2>
          <p>Routes allow you to easily categorize the urls and REST methods to call for different purposes</p>.
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.routes({
  index: {
    method: "GET",
    route: "/users"
  }
});

m$.user_table.api({
  get_users: function(_$, options) {
    $.ajax(_$.routes.index)
      .done(function() { alert("yeah!") })
      .fail(function() { alert("aww.") });
  }
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <p>You can also interpolate strings for id-specific routing</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.routes({
  show: {
    method: "GET",
    route: "/users/#{user_id}"
  }
});

m$.user_table.api({
  show_user: function(_$, options) {
    // Will GET "/users/5"
    $.ajax(_$.routes.index({ user_id: options.id }))
      .done(function() { alert("yeah!") })
      .fail(function() { alert("aww.") });
  }
});

m$.user_table.events(function(_$) {
  _$(".user-row").click(function() {
    // Assuming id = 5
    _$.api.show_user({ id: $(this).data().id });
  })
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h2 class="xs">Define events</h2>
          <h3 class="xxs">Selecting</h3>
          <p>Events allow you to scope selectors to your component and easily route behaviors to your api.</p>
          <p>Remember to pass in a function that takes <code>_$</code>.</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.events(function(_$) {
  _$("button").click(function() {
    alert("You clicked on the button that was in the user_table component")
  });

  $("button").click(function() {
    // Notice this one uses $ and not _$
    alert("The button you clicked on may or may not be in user_table component");
  });
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h3 class="xxs">Calling the API</h3>
          <p>Use the same syntax to call to the api as you would in an API function.</p>
          <p>Ideally, event definitions do nothing more than route actions to apis.</p>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.user_table.events(function(_$) {
  _$("button").click(function() {
    m$.notification.show({
      message: "Loading users...",
      type: "info"
    });
    _$.api.load_users();
    m$.notification.hide();

    // Notice the first and last calls are to
    // another component's api while the middle
    // line calls to its own.
  });
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <h1 class="sm">Special Topics</h1>
          <h2 class="xs">Dealing with collections</h2>
          <p><code>_$</code> is a useful shortcut to scoping to a particular
            but this will give you all instances anywhere on the page.</p>
          <p>This is of course different from scoping to one of several copies
          of your component.</p>
        </div>
        <div class="code">
          <pre><code class="html"><div data-component="title_maker">
  <h1>Title unchanged</h1>
  <button>Change title</button>
</div>

<div data-component="title_maker">
  <h1>Title unchanged</h1>
  <button>Change title</button>
</div></code>

<code class="javascript">m$.title_maker.events(function(_$) {
  _$("button").click(function() {
    // Change the title of the container this button is in.
  })
});</code></pre>
        </div>
      </main>

      <main class="document">
        <div class="content">
          <p><code>_$</code> lets us immediately select the title_maker component
            but we want <em>this button's</em> title_maker.</p>
          <p>With jQuery, we can use the parent finding <code>closest</code> and
            pull in <code>_$.scope</code> to give us the string, <code>[data-component~="title_maker"]</code></p>
          <p>Although in this case we could also skip this and use the <code>sibling</code>
          selector to reach across to the <code><h1></h1></code>
        </div>
        <div class="code">
          <pre><code class="javascript">m$.title_maker.events(function(_$){
  _$("button").click(function() {
    $(this).closest(_$.scope).find("h1")).html("title changed")
  })
});</code></pre>
        </div>
      </main>

      <!-- <main class="document">
        <div class="content">
        </div>
        <div class="code">
          <pre><code class="javascript">
</code></pre>
        </div>
      </main> -->


      <main class="document">
        <div class="content">
          <p>Check back later this week. Documentation is underway.</p>
          <p>This page was <a href="http://getkickstart.com">built with Kickstart</a>. Table of Contents generated by <a href="https://github.com/adamjgrant/Smooth-ToCer">Smooth ToCer</a></p>
        </div>
        <div class="code"></div>
      </main>

    </div>
    <style>
      .docs > main {
        opacity: 1;
      }

      .docs { width: 100%; }

      .document {
        width: 100%;
        display: flex;
        align-items: stretch;
      }

      .document .content,
      .document .code {
        width: 100%;
        padding: 25px;
      }

      .document .content {
        padding-left: calc(50vw - 600px);
        max-width: calc(50vw - 20px);
        margin-left:25px;
      }

      .document .code {
        background: #233c46;
        padding: 0;
        max-width:calc(50vw - 5px);
      }

      pre, code {
        padding: 0;
        border-radius: 0px;
        height: 100%;
        overflow: hidden;
      }

      pre code.hljs {
        padding: 25px;
        background: #233c46;
        font-size: 14px;
      }
    </style>
    <script>
    function escapeHTML(str) {
      var div = document.createElement('div');
      div.appendChild(document.createTextNode(str));
      return div.innerHTML;
    }
    document.querySelectorAll('code.html').forEach(function(htmlcode) {
      htmlcode.innerHTML = escapeHTML(htmlcode.innerHTML);
    });
    </script>
    <link rel="stylesheet" href="tomorrow-night-eighties.min.css">
    <script src="highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="smoothtocer.js"></script>
    <script>
      smoothtocer(document.querySelector('#toc'), document.querySelector('.docs'));
    </script>
  </body>
</html>
